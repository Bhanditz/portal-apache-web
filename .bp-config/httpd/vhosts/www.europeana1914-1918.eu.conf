<VirtualHost *:*>
    ServerName ${1914_1918_HOST}

    # Locales available in the portal
    SetEnvIf Request_URI . LOCALES=bg|ca|da|de|el|en|es|et|fi|fr|hr|hu|it|lt|lv|mt|no|nl|pl|pt|ro|ru|sv

    RewriteEngine on

    # Locales not available in the portal
    RewriteRule !^/(%{ENV:LOCALES})(/.*)?$ /en$2

    # Homepage
    RewriteRule ^(/%{ENV:LOCALES})?/?$ http://%{ENV:WWW_HOST}/portal$1/collections/firstworldwar [R=301,L]

    # Search
    ## With q param
    RewriteCond %{QUERY_STRING} (^|&)q=([^$&]*)
    RewriteRule ^(/%{ENV:LOCALES})?/(collection|digitalnz|dpla|trove|canadiana|europeana|contributions)/search$ http://%{ENV:WWW_HOST}/portal$1/collections/firstworldwar?q=%2 [R=301,L,QSD]
    ## Without q param
    RewriteRule ^(/%{ENV:LOCALES})?/(collection|digitalnz|dpla|trove|canadiana|europeana|contributions)/search$ http://%{ENV:WWW_HOST}/portal$1/collections/firstworldwar [R=301,L,QSD]

    # Europeana 1914-1918 records
    RewriteRule ^(/%{ENV:LOCALES})?/contributions/(.*)$ http://%{ENV:WWW_HOST}/portal$1/record/2020601/contributions_$2.html [R=301,L]

    # Other Europeana records
    RewriteRule ^(/%{ENV:LOCALES})?/europeana/record/(.*)$ http://%{ENV:WWW_HOST}/portal$1/record/$2.html [R=301,L]

    # Federated records
    RewriteRule ^(/%{ENV:LOCALES})?/digitalnz/record/(.*)$ http://api.digitalnz.org/records/$2/source [R=301,L]
    RewriteRule ^(/%{ENV:LOCALES})?/dpla/record/(.*)$ https://dp.la/item/$2 [R=301,L]
    RewriteRule ^(/%{ENV:LOCALES})?/trove/record/(.*)$ http://trove.nla.gov.au/work/$2 [R=301,L]
    RewriteRule ^(/%{ENV:LOCALES})?/canadiana/record/(.*)$ http://online.canadiana.ca/view/$2 [R=301,L]

    # UGC features
    RewriteRule ^(/%{ENV:LOCALES})?/(contributor|contributions/new|users/sign-out|users/sign-in|users/password/new|users/register|users/account)$ http://%{ENV:WWW_HOST}/portal$1/collections/firstworldwar/contribute#$2 [R=301,L,NE]
</VirtualHost>
