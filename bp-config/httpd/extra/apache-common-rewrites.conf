#
# Vers 1.6.0    by jaclu  2015-02-23 10:50
# (last deployed 1.5.8)
#
#  Latest changes:
#   added environment variable pointing to port to be used by
#   tomcat backend TOMCAT_PORT
#   removed LogLevel from this include file
#   it should go in the main config
#   redirect for /portal/explore.html
#
# 
# This file is completely location agnostic, 
# so should be useable on any server unmodified.
# To use this file wrap it in something like:
#
Timeout 300

# Tell mod_mod proxy that it should not send back the body-content of
# error pages, but be fascist and use its local error pages if the
# remote HTTP stack is sending an HTTP 4xx or 5xx status code.
ProxyErrorOverride On

ErrorDocument 400 /error.html
ErrorDocument 404 /error.html
ErrorDocument 500 /unavailable.html
ErrorDocument 501 /unavailable.html
ErrorDocument 502 /unavailable.html
ErrorDocument 503 /unavailable.html
ErrorDocument 504 /unavailable.html

RewriteEngine   on

#
# Point from official location to actual location
# (a translomatic page)
#
RewriteRule ^/schemas/ese/$  /portal/ese_index.html [P,L]
RewriteRule ^/schemas/$  /portal/schema_index.html [P,L]



#<FilesMatch \.ttf$>
#
# Search widget handling
#
<Location /portal/themes/default/images/europeana-font-files>
    Header set Access-Control-Allow-Origin "*"
</Location>



#
#  EDM handling
#    
#    For a few rdf-tools, we serve specific pages, 
#    all others are pointed to pro
#
SetEnvIfNoCase Accept (ttl|text/turtle|application/x-turtle|application/turtle|text/rdf\+turtle) edm_ttl
RewriteCond %{ENV:edm_ttl} 1
RewriteRule ^/schemas/edm/$ /schemas/edm/rdf/edm.ttl [R=303] 
<Files ~ "\.ttl$">
    Header set Content-type application/x-turtle
</Files>

SetEnvIfNoCase Accept (n3|text/n3|text/rdf\+n3) edm_n3
RewriteCond %{ENV:edm_n3} 1
RewriteRule ^/schemas/edm/$ /schemas/edm/rdf/edm.n3 [R=303]
<Files ~ "\.n3$">
    Header set Content-type text/rdf+n3
</Files>

SetEnvIfNoCase Accept (rdf|rdf/xml|application/rdf\+xml) edm_owl
RewriteCond %{ENV:edm_owl} 1
RewriteRule ^/schemas/edm/$ /schemas/edm/rdf/edm.owl [R=303]
<Files ~ "\.owl$">
    Header set Content-type application/rdf+xml
</Files>

SetEnvIfNoCase Accept (text/nt) edm_nt
RewriteCond %{ENV:edm_nt} 1
RewriteRule ^/schemas/edm/$ /schemas/edm/rdf/edm.nt [R=303]
<Files ~ "\.nt$">
    Header set Content-type text/nt
</Files>

# Default case
RewriteRule ^/schemas/edm/$ http://pro.europeana.eu/edm-documentation  [R=303]	


#
# handling api v1 record notation
#
# /api/v1/record/92062/B34553D35ACB895C28CE1A0A67184BD26079DFB8.html -->
# /portal/record/92062/B34553D35ACB895C28CE1A0A67184BD26079DFB8.html
# 
RewriteCond  %{REQUEST_URI}  ^/api/v1/record/(\w+)/(\w+).html$
RewriteRule ^/api /portal/record/%1/%2.html [R=301]


#
# Handling of older record notation
#
# /resolve/record/08535/1D7DB170BFA0AC9B36646F00D442542DD048FE69  -->
# /portal/record/08535/1D7DB170BFA0AC9B36646F00D442542DD048FE69.html
#
RewriteCond  %{REQUEST_URI}  ^/resolve/record/(\w+)/(\w+)$
RewriteRule ^/resolve /portal/record/%1/%2.html [R=301]

#
# Styleguide redirects 
#
#RewriteRule ^/portal/themes/default/js/eu/europeana/min/EuSearchWidget.min.js http://develop.styleguide.eanadev.org/search-widget/EuSearchWidget.min.js [R=301]


#
# Old locations for some pages we need to be backwards compatible with
#
RewriteRule ^/about/jobs$ http://pro.europeana.eu/jobs  [R=301] #new chech this extra pro
RewriteRule ^/edlnet/edl_foundation/purpose.php$ http://pro.europeana.eu/foundation   [R=301] #new pro
RewriteRule ^/index.php$  /   [R=301] #new
RewriteRule ^/partners_list.php$ http://pro.europeana.eu/network/members [R=301] #new pro
RewriteRule ^/portal/aboutus_demos.html$ /portal/aboutus.html  [R=301]
RewriteRule ^/portal/aboutus_press.html$ http://pro.europeana.eu/news   [R=301] #new pro
RewriteRule ^/portal/accessibility.html$ /portal/rights/accessibility.html   [R=301]
RewriteRule ^/portal/api-common-fields.html$ /portal/api-introduction.html    [R=301] #new
RewriteRule ^/portal/api-documentation.html$ /portal/api-introduction.html   [R=301]
RewriteRule ^/portal/api-europeana-repository.html$  /portal/api-introduction.html  [R=301] #new
RewriteRule ^/portal/explore.html$ /portal/usingeuropeana_explore.html   [R=301]
RewriteRule ^/portal/languagepolicy.html$ /portal/rights/privacy.html   [R=301]
RewriteRule ^/portal/pd-usage-guide.html$ /portal/rights/pd-usage-guide.html   [R=301] #new
RewriteRule ^/portal/privacy.html$ /portal/rights/privacy.html   [R=301]
RewriteRule ^/portal/reading_europe.html$  http://www.theeuropeanlibrary.org/exhibition-reading-europe/   [R=301] #new edl
RewriteRule ^/portal/rr-f.html$ /portal/rights/rr-f.html   [R=301] #new
RewriteRule ^/portal/termsofservice.html$ /portal/rights/terms-of-use.html   [R=301]
RewriteRule ^/portal/thoughtlab_semanticsearching.html$ http://pro.europeana.eu/thoughtlab/new-ways-of-searching-and-browsing [R=301]
RewriteRule ^/portal/thoughtlab_improvingmetadata.html$ http://pro.europeana.eu/thoughtlab/improving-metadata-quality [R=301]
RewriteRule ^/portal/thoughtlab_usergeneratedcontent.html$ http://pro.europeana.eu/thoughtlab/user-generated-content [R=301]
RewriteRule ^/portal/thoughtlab_enrichingmetadata.html$ http://pro.europeana.eu/thoughtlab/enriching-metadata [R=301]
RewriteRule ^/portal/thoughtlab_linkedopendata.html$ http://pro.europeana.eu/thoughtlab/linked-open-data [R=301]
RewriteRule ^/portal/thoughtlab_interoperability.html$ http://pro.europeana.eu/thoughtlab/interoperability [R=301]
RewriteRule ^/portal/thoughtlab_serviceinfrastructure.html$ http://pro.europeana.eu/thoughtlab/service-infrastructure [R=301]
RewriteRule ^/portal/thoughtlab_digitallibrarycatalogue.html$ http://pro.europeana.eu/thoughtlab/digital-library-catalogue [R=301]
RewriteRule ^/portal/thoughtlab_digitisation.html$ http://pro.europeana.eu/thoughtlab/digitisation [R=301]
RewriteRule ^/portal/thoughtlab$ http://pro.europeana.eu/thoughtlab   [R=301] #new pro
RewriteRule ^/portal/using-europeana.html$ /portal/usingeuropeana.html   [R=301] #new
RewriteRule ^/rights/metadata-usage-guidelines /portal/rights/metadata-usage-guidelines.html    [R=302]
RewriteRule ^/rights/orphan-work-eu /portal/rights/orphan-work-eu.html [R=302]
RewriteRule ^/rights/out-of-copyright-non-commercial /portal/rights/out-of-copyright-non-commercial.html [R=302] 
RewriteRule ^/rights/pd-usage-guide /portal/rights/pd-usage-guide.html [R=302]
RewriteRule ^/rights/rr-f/$ /portal/rights/rr-f.html [R=301]
RewriteRule ^/rights/rr-p/$ /portal/rights/rr-p.html [R=301]
RewriteRule ^/rights/rr-r/$ /portal/rights/rr-r.html [R=301]
RewriteRule ^/rights/termsofservice.html$ /portal/rights/terms-of-use.html   [R=301]
RewriteRule ^/rights/termsofuse /portal/rights/terms-of-use.html   [R=301]
RewriteRule ^/rights/unknown/$ /portal/rights/unknown.html [R=301]
RewriteRule ^/rights/([\w-]*).html$ /portal/rights/$1.html     [R=302]
RewriteRule ^/terms-for-user-contributions /portal/rights/terms-for-user-contributions.html [R=302]


#
# obsolete and invalid pages
#
RewriteRule ^/oauth/authorize$ /api/oauth/authorize  [R=301] #new chech this extra pro
RewriteRule ^/portal/rec.html$ / [R=410]
RewriteRule ^/portal/communities_biodiversity.html$ / [R=410]
RewriteRule ^/portal/communities_maps.html$ / [R=410]
RewriteRule ^/portal/communities.html$ / [R=410]
RewriteRule ^/portal/communities_artnouveau.html$ / [R=410]
RewriteRule ^/portal/communities_medieval.html$ / [R=410]
RewriteRule ^/portal/kindle_competition.html$ / [R=410]
